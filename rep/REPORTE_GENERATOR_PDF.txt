=================================================================
ğŸ“Š MÃ“DULO DE REPORTES - GUÃA COMPLETA
=================================================================

Bienvenido a la documentaciÃ³n completa del mÃ³dulo de Reportes del Sistema MIMS.
Esta guÃ­a te explicarÃ¡ todo lo que necesitas saber sobre este mÃ³dulo, desde su
estructura hasta cÃ³mo generar PDFs y usar todas sus funcionalidades.

Autor: Sistema MIMS
Fecha: 2025
VersiÃ³n: 1.0

=================================================================
ğŸ“‹ TABLA DE CONTENIDO
=================================================================

1. INTRODUCCIÃ“N AL MÃ“DULO
2. ESTRUCTURA DEL MÃ“DULO
3. MODELO DE DATOS (Reporte)
4. ENDPOINTS Y API
5. GENERACIÃ“N DE PDF
6. PERMISOS Y SEGURIDAD
7. EJEMPLOS DE USO
8. SOLUCIÃ“N DE PROBLEMAS
9. MEJORES PRÃCTICAS

=================================================================
1. INTRODUCCIÃ“N AL MÃ“DULO
=================================================================

El mÃ³dulo de Reportes permite gestionar, crear, editar y consultar reportes
del sistema. Cada reporte puede tener:
- Fecha de mediciÃ³n (cuÃ¡ndo se tomaron los datos)
- Estado del reporte (pendiente, en proceso, completado, etc.)
- ID Ãºnico del reporte
- Tipo de reporte (inventario, ventas, financiero, etc.)
- Relaciones con usuarios y droguerÃ­as
- GeneraciÃ³n de PDF profesional
- EnvÃ­o por correo electrÃ³nico

Este mÃ³dulo estÃ¡ diseÃ±ado siguiendo las mejores prÃ¡cticas de Django y Django
REST Framework, similar al mÃ³dulo de facturaciÃ³n pero adaptado para reportes.

=================================================================
2. ESTRUCTURA DEL MÃ“DULO
=================================================================

El mÃ³dulo de reportes estÃ¡ organizado en la siguiente estructura:

reportes/
â”œâ”€â”€ __init__.py              # InicializaciÃ³n del mÃ³dulo
â”œâ”€â”€ apps.py                  # ConfiguraciÃ³n de la aplicaciÃ³n Django
â”œâ”€â”€ models.py                # Modelo de datos Reporte
â”œâ”€â”€ serializers.py           # Serializers para API
â”œâ”€â”€ views.py                 # Vistas (endpoints) del mÃ³dulo
â”œâ”€â”€ urls.py                  # ConfiguraciÃ³n de rutas URL
â”œâ”€â”€ permissions.py           # Sistema de permisos
â”œâ”€â”€ admin.py                 # ConfiguraciÃ³n del admin de Django
â”œâ”€â”€ tests.py                 # Tests unitarios (pendiente)
â”œâ”€â”€ utils/                   # Utilidades
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ pdf_generator.py     # Generador de PDF para reportes
â””â”€â”€ REPORTE_GENERATOR_PDF.txt  # Esta documentaciÃ³n

Cada archivo tiene un propÃ³sito especÃ­fico y estÃ¡ bien comentado para facilitar
el mantenimiento y comprensiÃ³n del cÃ³digo.

=================================================================
3. MODELO DE DATOS (Reporte)
=================================================================

El modelo Reporte almacena toda la informaciÃ³n de un reporte. AquÃ­ te explico
cada campo en detalle:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMPOS PRINCIPALES                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ id_reporte (CharField, Ãºnico)
  - CÃ³digo Ãºnico identificador del reporte
  - Formato: REP-YYYYMMDD-HHMMSS-XXXX
  - Se genera automÃ¡ticamente si no se proporciona
  - Ejemplo: REP-20250125-143022-0001

â€¢ titulo (CharField, mÃ¡ximo 200 caracteres)
  - TÃ­tulo descriptivo del reporte
  - Ejemplo: "Reporte de Inventario Enero 2025"
  - Campo obligatorio

â€¢ tipo_reporte (CharField con choices)
  - ClasificaciÃ³n del tipo de reporte
  - Opciones disponibles:
    * inventario: Reportes de inventario
    * ventas: Reportes de ventas
    * financiero: Reportes financieros
    * medicamentos: Reportes de medicamentos
    * pedidos: Reportes de pedidos
    * clientes: Reportes de clientes
    * general: Reportes generales
    * personalizado: Reportes personalizados

â€¢ fecha_medicion (DateTimeField)
  - Fecha y hora en que se realizÃ³ la mediciÃ³n o se tomaron los datos
  - Importante: No puede ser una fecha futura
  - Se usa para ordenar y filtrar reportes por perÃ­odo

â€¢ estado (CharField con choices)
  - Estado actual del reporte
  - Opciones disponibles:
    * pendiente: El reporte estÃ¡ pendiente de procesamiento
    * en_proceso: El reporte estÃ¡ siendo procesado
    * completado: El reporte estÃ¡ completo
    * revisado: El reporte ha sido revisado
    * aprobado: El reporte ha sido aprobado
    * rechazado: El reporte fue rechazado
    * cancelado: El reporte fue cancelado

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RELACIONES                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ creado_por (ForeignKey a Usuario)
  - Usuario que creÃ³ el reporte
  - Se asigna automÃ¡ticamente al crear un reporte
  - RelaciÃ³n: muchos reportes â†’ un usuario

â€¢ revisado_por (ForeignKey a Usuario, opcional)
  - Usuario que revisÃ³ el reporte
  - Se asigna cuando el reporte es revisado o aprobado

â€¢ drogueria (ForeignKey a Drogueria, opcional)
  - DroguerÃ­a asociada al reporte
  - Permite filtrar reportes por droguerÃ­a

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INFORMACIÃ“N ADICIONAL                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ descripcion (TextField, opcional)
  - DescripciÃ³n detallada del contenido del reporte
  - Puede contener texto largo explicando quÃ© contiene el reporte

â€¢ observaciones (TextField, opcional)
  - Observaciones, notas o comentarios adicionales
  - Ãštil para anotaciones sobre el reporte

â€¢ datos_json (JSONField, opcional)
  - Datos estructurados del reporte en formato JSON
  - Permite almacenar datos complejos y estructurados
  - Ejemplo:
    {
      "total_medicamentos": 150,
      "stock_bajo": 12,
      "medicamentos_vencidos": 3,
      "valor_total": 5000000
    }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FECHAS DE AUDITORÃA                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ fecha_creacion (DateTimeField, automÃ¡tico)
  - Se crea automÃ¡ticamente al guardar el reporte por primera vez
  - No se puede modificar manualmente

â€¢ fecha_actualizacion (DateTimeField, automÃ¡tico)
  - Se actualiza automÃ¡ticamente cada vez que se modifica el reporte
  - Ãštil para saber cuÃ¡ndo fue la Ãºltima modificaciÃ³n

â€¢ fecha_revision (DateTimeField, opcional)
  - Fecha en que fue revisado el reporte
  - Se establece automÃ¡ticamente al marcar como revisado

â€¢ fecha_aprobacion (DateTimeField, opcional)
  - Fecha en que fue aprobado el reporte
  - Se establece automÃ¡ticamente al marcar como aprobado

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVOS Y ESTADO                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ archivo_pdf (CharField, opcional)
  - Ruta al archivo PDF generado del reporte
  - Se usa si se guarda el PDF en el servidor

â€¢ pdf_generado (BooleanField, default=False)
  - Indica si el PDF del reporte ya fue generado
  - Se marca automÃ¡ticamente al descargar el PDF

â€¢ correo_enviado (BooleanField, default=False)
  - Indica si el reporte fue enviado por correo electrÃ³nico
  - Se marca automÃ¡ticamente al enviar por correo

=================================================================
4. ENDPOINTS Y API
=================================================================

El mÃ³dulo de reportes expone varios endpoints REST para interactuar con
los reportes. Todos los endpoints requieren autenticaciÃ³n JWT.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENDPOINTS PRINCIPALES                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BASE URL: /api/reportes/

1. LISTAR TODOS LOS REPORTES
   GET /api/reportes/reportes/
   
   DescripciÃ³n: Obtiene la lista de todos los reportes
   Permisos: Empleado o Administrador (ver todos), Cliente (solo los suyos)
   
   ParÃ¡metros opcionales de consulta (query params):
   - ?estado=pendiente        Filtra por estado
   - ?tipo_reporte=inventario Filtra por tipo
   - ?creado_por=5            Filtra por usuario creador
   
   Respuesta exitosa (200):
   [
     {
       "id": 1,
       "id_reporte": "REP-20250125-143022-0001",
       "titulo": "Reporte de Inventario",
       "tipo_reporte": "inventario",
       "estado": "completado",
       "fecha_medicion": "2025-01-25T14:30:22Z",
       "creado_por_nombre": "Juan PÃ©rez",
       "drogueria_nombre": "DroguerÃ­a Principal",
       "fecha_creacion": "2025-01-25T14:30:22Z",
       "pdf_generado": true
     },
     ...
   ]

2. CREAR UN NUEVO REPORTE
   POST /api/reportes/reportes/
   
   DescripciÃ³n: Crea un nuevo reporte
   Permisos: Empleado o Administrador
   
   Cuerpo de la peticiÃ³n (JSON):
   {
     "titulo": "Reporte de Inventario Enero 2025",
     "tipo_reporte": "inventario",
     "fecha_medicion": "2025-01-25T14:30:22Z",
     "estado": "pendiente",
     "drogueria": 1,
     "descripcion": "Reporte mensual de inventario",
     "observaciones": "Todo en orden",
     "datos_json": {
       "total_medicamentos": 150,
       "stock_bajo": 12
     }
   }
   
   Respuesta exitosa (201):
   {
     "id": 1,
     "id_reporte": "REP-20250125-143022-0001",
     "titulo": "Reporte de Inventario Enero 2025",
     ...
   }

3. OBTENER UN REPORTE ESPECÃFICO
   GET /api/reportes/reportes/{id}/
   
   DescripciÃ³n: Obtiene los detalles completos de un reporte
   Permisos: Empleado/Admin (cualquiera), Cliente (solo los suyos)
   
   Respuesta exitosa (200):
   {
     "id": 1,
     "id_reporte": "REP-20250125-143022-0001",
     "titulo": "Reporte de Inventario Enero 2025",
     "tipo_reporte": "inventario",
     "estado": "completado",
     "fecha_medicion": "2025-01-25T14:30:22Z",
     "creado_por": 1,
     "creado_por_nombre": "Juan PÃ©rez",
     "revisado_por": 2,
     "revisado_por_nombre": "MarÃ­a GarcÃ­a",
     "drogueria": 1,
     "drogueria_nombre": "DroguerÃ­a Principal",
     "descripcion": "Reporte mensual de inventario",
     "observaciones": "Todo en orden",
     "datos_json": {...},
     "fecha_creacion": "2025-01-25T14:30:22Z",
     "fecha_actualizacion": "2025-01-25T15:00:00Z",
     "fecha_revision": "2025-01-25T14:45:00Z",
     "fecha_aprobacion": "2025-01-25T15:00:00Z",
     "archivo_pdf": null,
     "pdf_generado": true,
     "correo_enviado": false
   }

4. ACTUALIZAR UN REPORTE
   PUT /api/reportes/reportes/{id}/
   PATCH /api/reportes/reportes/{id}/
   
   DescripciÃ³n: Actualiza un reporte existente
   Permisos: Empleado/Admin (cualquiera), Cliente (solo los suyos)
   
   Cuerpo de la peticiÃ³n (JSON, solo campos a actualizar):
   {
     "estado": "completado",
     "observaciones": "Reporte completado y revisado"
   }
   
   Respuesta exitosa (200): Reporte actualizado

5. ELIMINAR UN REPORTE
   DELETE /api/reportes/reportes/{id}/
   
   DescripciÃ³n: Elimina un reporte
   Permisos: Empleado o Administrador
   
   Respuesta exitosa (204): Sin contenido

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENDPOINTS ADICIONALES                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. LISTAR REPORTES CON FILTROS
   GET /api/reportes/lista/
   
   DescripciÃ³n: Lista reportes con filtros avanzados
   ParÃ¡metros: Mismos que el endpoint principal

7. MIS REPORTES
   GET /api/reportes/mis-reportes/
   
   DescripciÃ³n: Lista solo los reportes creados por el usuario autenticado
   Permisos: Usuario autenticado

8. CREAR REPORTE MANUAL
   POST /api/reportes/crear/
   
   DescripciÃ³n: Crea un reporte de forma manual (usado por el panel)
   Permisos: Empleado o Administrador

9. CONSULTAR ESTADO DE UN REPORTE
   GET /api/reportes/reportes/{id}/estado/
   
   DescripciÃ³n: Consulta solo el estado de un reporte especÃ­fico
   Respuesta:
   {
     "id_reporte": "REP-20250125-143022-0001",
     "titulo": "Reporte de Inventario",
     "estado": "completado",
     "fecha_creacion": "2025-01-25T14:30:22Z",
     "fecha_actualizacion": "2025-01-25T15:00:00Z",
     "fecha_revision": "2025-01-25T14:45:00Z",
     "fecha_aprobacion": "2025-01-25T15:00:00Z",
     "pdf_generado": true
   }

10. APROBAR UN REPORTE
    POST /api/reportes/reportes/{id}/aprobar/
    
    DescripciÃ³n: Aprueba un reporte (solo administradores)
    Permisos: Solo Administrador
    
    Respuesta exitosa (200):
    {
      "mensaje": "Reporte REP-20250125-143022-0001 aprobado correctamente",
      "reporte_id": 1,
      "estado": "aprobado",
      "fecha_aprobacion": "2025-01-25T15:00:00Z"
    }

11. DESCARGAR PDF DEL REPORTE
    GET /api/reportes/reportes/{id}/descargar/
    
    DescripciÃ³n: Descarga el PDF del reporte
    Permisos: Usuario autenticado (puede ver el reporte)
    
    Respuesta: Archivo PDF para descargar
    Headers:
    - Content-Type: application/pdf
    - Content-Disposition: attachment; filename="reporte_REP-XXX_20250125.pdf"

12. ENVIAR REPORTE POR CORREO
    POST /api/reportes/reportes/{id}/enviar-email/
    
    DescripciÃ³n: EnvÃ­a el reporte por correo electrÃ³nico
    Permisos: Empleado o Administrador
    
    Cuerpo de la peticiÃ³n (JSON, opcional):
    {
      "email": "destinatario@example.com"
    }
    Si no se especifica el email, se envÃ­a al creador del reporte.
    
    Respuesta exitosa (200):
    {
      "mensaje": "Reporte enviado a destinatario@example.com",
      "reporte_id": 1,
      "correo_enviado": true
    }

=================================================================
5. GENERACIÃ“N DE PDF
=================================================================

El mÃ³dulo de reportes incluye un generador de PDF profesional usando ReportLab.
El PDF generado incluye toda la informaciÃ³n del reporte en un formato bien
estructurado y fÃ¡cil de leer.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ESTRUCTURA DEL PDF                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ENCABEZADO
   - Logo/nombre de la empresa (DroguerÃ­a MIMS S.A.S)
   - InformaciÃ³n de contacto (NIT, TelÃ©fono, DirecciÃ³n)

2. TÃTULO DEL REPORTE
   - ID del reporte (ej: REPORTE REP-20250125-143022-0001)
   - TÃ­tulo del reporte en cursiva

3. INFORMACIÃ“N GENERAL
   - Tabla con todos los datos principales:
     * ID del Reporte
     * Tipo de Reporte
     * Estado (con colores segÃºn el estado)
     * Fecha de MediciÃ³n
     * Fecha de CreaciÃ³n
     * Ãšltima ActualizaciÃ³n
     * Creado Por
     * Revisado Por
     * Fecha de RevisiÃ³n
     * Fecha de AprobaciÃ³n
     * DroguerÃ­a

4. DESCRIPCIÃ“N
   - DescripciÃ³n detallada del reporte (si existe)

5. OBSERVACIONES
   - Observaciones o notas (si existen)

6. DATOS JSON (si existen)
   - Tabla con los datos estructurados del reporte
   - Se muestran los primeros 20 elementos para evitar PDFs muy largos

7. RESUMEN DEL ESTADO
   - Estado actual con fondo de color segÃºn el estado:
     * Pendiente: Amarillo claro
     * En Proceso: Azul claro
     * Completado: Verde claro
     * Revisado: Azul claro
     * Aprobado: Verde claro
     * Rechazado: Rojo claro
     * Cancelado: Rojo claro
   - Indicador de PDF generado
   - Indicador de correo enviado

8. FOOTER
   - InformaciÃ³n del sistema
   - Fecha de generaciÃ³n del PDF

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USO DEL GENERADOR DE PDF                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El PDF se genera automÃ¡ticamente cuando se descarga un reporte. Para usar
el generador directamente desde Python:

from reportes.utils.pdf_generator import generar_pdf_reporte
from reportes.models import Reporte

# Obtener un reporte
reporte = Reporte.objects.get(id=1)

# Generar el PDF
pdf_buffer = generar_pdf_reporte(reporte)

# Guardar el PDF en un archivo
with open('reporte.pdf', 'wb') as f:
    f.write(pdf_buffer.getvalue())

# O devolverlo en una respuesta HTTP
from django.http import HttpResponse
response = HttpResponse(pdf_buffer.getvalue(), content_type='application/pdf')
response['Content-Disposition'] = 'attachment; filename="reporte.pdf"'
return response

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PERSONALIZACIÃ“N DEL PDF                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Para personalizar el PDF, edita el archivo:
reportes/utils/pdf_generator.py

Puedes modificar:
- Colores y estilos
- Estructura del documento
- InformaciÃ³n mostrada
- Formato de las tablas
- Logo de la empresa (agregando imÃ¡genes)

=================================================================
6. PERMISOS Y SEGURIDAD
=================================================================

El mÃ³dulo de reportes implementa un sistema de permisos robusto para
garantizar que solo los usuarios autorizados puedan realizar ciertas
acciones.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROLES Y PERMISOS                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMINISTRADOR:
- âœ… Crear reportes
- âœ… Ver todos los reportes
- âœ… Editar cualquier reporte
- âœ… Eliminar reportes
- âœ… Aprobar reportes
- âœ… Descargar PDFs de cualquier reporte
- âœ… Enviar reportes por correo

EMPLEADO:
- âœ… Crear reportes
- âœ… Ver todos los reportes
- âœ… Editar sus propios reportes
- âœ… Editar reportes pendientes (para asignarlos)
- âœ… Eliminar reportes
- âœ… Descargar PDFs de cualquier reporte
- âœ… Enviar reportes por correo
- âŒ Aprobar reportes (solo administradores)

CLIENTE:
- âœ… Ver sus propios reportes
- âœ… Consultar estado de sus reportes
- âœ… Descargar PDFs de sus reportes
- âŒ Crear reportes
- âŒ Editar reportes
- âŒ Eliminar reportes
- âŒ Aprobar reportes

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLASES DE PERMISOS                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El mÃ³dulo incluye varias clases de permisos personalizadas:

1. EsEmpleadoOAdministrador
   - Permite acceso completo a empleados y administradores
   - Los clientes solo pueden leer

2. PuedeCrearReporte
   - Solo empleados y administradores pueden crear reportes

3. PuedeEditarReporte
   - Solo el creador o un administrador puede editar un reporte
   - Los empleados pueden editar reportes pendientes

4. PuedeVerReporte
   - Controla quiÃ©n puede ver un reporte especÃ­fico
   - Los clientes solo ven sus propios reportes

5. PuedeAprobarReporte
   - Solo administradores pueden aprobar reportes

=================================================================
7. EJEMPLOS DE USO
=================================================================

AquÃ­ tienes ejemplos prÃ¡cticos de cÃ³mo usar el mÃ³dulo de reportes:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 1: CREAR UN REPORTE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// Desde JavaScript/Frontend (React)

import api from '../services/api';

const crearReporte = async () => {
  try {
    const reporteData = {
      titulo: "Reporte de Inventario Enero 2025",
      tipo_reporte: "inventario",
      fecha_medicion: new Date().toISOString(),
      estado: "pendiente",
      descripcion: "Reporte mensual de inventario de medicamentos",
      observaciones: "Se encontraron 12 medicamentos con stock bajo",
      datos_json: {
        total_medicamentos: 150,
        stock_bajo: 12,
        medicamentos_vencidos: 3,
        valor_total: 5000000
      }
    };

    const response = await api.post('/api/reportes/reportes/', reporteData, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    console.log('Reporte creado:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error al crear reporte:', error);
    throw error;
  }
};

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 2: LISTAR REPORTES CON FILTROS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const listarReportes = async (estado = null, tipo = null) => {
  try {
    let url = '/api/reportes/reportes/';
    const params = new URLSearchParams();
    
    if (estado) params.append('estado', estado);
    if (tipo) params.append('tipo_reporte', tipo);
    
    if (params.toString()) {
      url += '?' + params.toString();
    }

    const response = await api.get(url, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    return response.data;
  } catch (error) {
    console.error('Error al listar reportes:', error);
    throw error;
  }
};

// Uso:
const reportesCompletados = await listarReportes('completado');
const reportesInventario = await listarReportes(null, 'inventario');

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 3: DESCARGAR PDF DE UN REPORTE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const descargarPDF = async (reporteId) => {
  try {
    const response = await api.get(
      `/api/reportes/reportes/${reporteId}/descargar/`,
      {
        headers: {
          'Authorization': `Bearer ${token}`
        },
        responseType: 'blob' // Importante para archivos binarios
      }
    );

    // Crear un enlace de descarga
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', `reporte_${reporteId}.pdf`);
    document.body.appendChild(link);
    link.click();
    link.remove();
    window.URL.revokeObjectURL(url);
  } catch (error) {
    console.error('Error al descargar PDF:', error);
    throw error;
  }
};

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 4: ACTUALIZAR ESTADO DE UN REPORTE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const actualizarEstado = async (reporteId, nuevoEstado) => {
  try {
    const response = await api.patch(
      `/api/reportes/reportes/${reporteId}/`,
      {
        estado: nuevoEstado,
        observaciones: `Estado cambiado a ${nuevoEstado}`
      },
      {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      }
    );

    console.log('Reporte actualizado:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error al actualizar reporte:', error);
    throw error;
  }
};

// Uso:
await actualizarEstado(1, 'completado');

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 5: APROBAR UN REPORTE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const aprobarReporte = async (reporteId) => {
  try {
    const response = await api.post(
      `/api/reportes/reportes/${reporteId}/aprobar/`,
      {},
      {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    );

    console.log('Reporte aprobado:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error al aprobar reporte:', error);
    throw error;
  }
};

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 6: ENVIAR REPORTE POR CORREO                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const enviarPorCorreo = async (reporteId, emailDestinatario = null) => {
  try {
    const data = emailDestinatario ? { email: emailDestinatario } : {};
    
    const response = await api.post(
      `/api/reportes/reportes/${reporteId}/enviar-email/`,
      data,
      {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      }
    );

    console.log('Reporte enviado:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error al enviar reporte:', error);
    throw error;
  }
};

// Uso:
await enviarPorCorreo(1); // EnvÃ­a al creador del reporte
await enviarPorCorreo(1, 'otro@example.com'); // EnvÃ­a a un email especÃ­fico

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EJEMPLO 7: CONSULTAR ESTADO DE UN REPORTE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

const consultarEstado = async (reporteId) => {
  try {
    const response = await api.get(
      `/api/reportes/reportes/${reporteId}/estado/`,
      {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    );

    console.log('Estado del reporte:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error al consultar estado:', error);
    throw error;
  }
};

=================================================================
8. SOLUCIÃ“N DE PROBLEMAS
=================================================================

AquÃ­ encontrarÃ¡s soluciones a los problemas mÃ¡s comunes:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: Error 403 - No tienes permiso                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: El usuario no tiene los permisos necesarios para la acciÃ³n.

SOLUCIÃ“N:
1. Verifica que el usuario estÃ© autenticado
2. Verifica el rol del usuario (debe ser empleado o admin para crear/editar)
3. Si eres cliente, solo puedes ver/editar tus propios reportes
4. Para aprobar reportes, debes ser administrador

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: Error 400 - La fecha de mediciÃ³n no puede ser futuro  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: Se intentÃ³ crear un reporte con fecha de mediciÃ³n en el futuro.

SOLUCIÃ“N:
AsegÃºrate de que la fecha de mediciÃ³n sea una fecha pasada o presente:
  fecha_medicion: new Date().toISOString() // Fecha actual
  // O
  fecha_medicion: "2025-01-25T14:30:22Z" // Fecha especÃ­fica (pasada)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: Error al generar PDF                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: Puede ser un problema con ReportLab o datos invÃ¡lidos.

SOLUCIÃ“N:
1. Verifica que reportlab estÃ© instalado: pip install reportlab
2. Verifica que el reporte tenga datos vÃ¡lidos
3. Revisa los logs del servidor para mÃ¡s detalles
4. AsegÃºrate de que el reporte exista en la base de datos

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: Error al enviar correo                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: Problema con la configuraciÃ³n de correo o email invÃ¡lido.

SOLUCIÃ“N:
1. Verifica la configuraciÃ³n de correo en settings.py
2. AsegÃºrate de que el destinatario tenga un email vÃ¡lido
3. Verifica las credenciales de email en el archivo .env
4. Revisa los logs del servidor para mÃ¡s detalles

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: ID del reporte no se genera automÃ¡ticamente           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: El mÃ©todo generar_id_reporte() no se estÃ¡ llamando correctamente.

SOLUCIÃ“N:
El ID se genera automÃ¡ticamente al crear el reporte. Si no se genera:
1. Verifica que el reporte se haya guardado correctamente
2. El ID se genera despuÃ©s del primer guardado, asÃ­ que puede ser necesario
   recargar el objeto desde la base de datos:
   
   reporte = Reporte.objects.create(...)
   reporte.refresh_from_db()
   print(reporte.id_reporte) // Ahora deberÃ­a tener el ID

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROBLEMA: No se pueden filtrar reportes                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CAUSA: Los parÃ¡metros de filtro pueden estar mal formados.

SOLUCIÃ“N:
AsegÃºrate de usar los nombres correctos de los parÃ¡metros:
  âœ… ?estado=pendiente
  âœ… ?tipo_reporte=inventario
  âœ… ?creado_por=5
  âŒ ?estado_report=pendiente (incorrecto)
  âŒ ?tipo=inventario (incorrecto)

=================================================================
9. MEJORES PRÃCTICAS
=================================================================

AquÃ­ tienes algunas mejores prÃ¡cticas para usar el mÃ³dulo de reportes:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREACIÃ“N DE REPORTES                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Siempre proporciona un tÃ­tulo descriptivo y claro
2. Selecciona el tipo de reporte correcto
3. Usa fecha_medicion para indicar cuÃ¡ndo se tomaron los datos
4. Incluye una descripciÃ³n detallada cuando sea posible
5. Usa datos_json para almacenar informaciÃ³n estructurada

EJEMPLO BUENO:
{
  "titulo": "Reporte de Inventario - Enero 2025",
  "tipo_reporte": "inventario",
  "fecha_medicion": "2025-01-31T23:59:59Z",
  "descripcion": "Reporte mensual de inventario con anÃ¡lisis de stock",
  "datos_json": {
    "total_medicamentos": 150,
    "stock_bajo": 12,
    "medicamentos_vencidos": 3
  }
}

EJEMPLO MALO:
{
  "titulo": "Reporte",
  "tipo_reporte": "general",
  "fecha_medicion": "2026-12-31T23:59:59Z", // Fecha futura
  "descripcion": ""
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GESTIÃ“N DE ESTADOS                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Usa el flujo de estados recomendado:
   pendiente â†’ en_proceso â†’ completado â†’ revisado â†’ aprobado

2. Usa observaciones para documentar cambios de estado

3. No cambies directamente a "aprobado" sin pasar por "revisado"

4. Usa "rechazado" o "cancelado" cuando sea apropiado

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ORGANIZACIÃ“N DE DATOS                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Usa datos_json para informaciÃ³n estructurada:
   {
     "metricas": {
       "total": 100,
       "promedio": 50
     },
     "detalles": [
       {"item": "A", "valor": 10},
       {"item": "B", "valor": 20}
     ]
   }

2. MantÃ©n la descripciÃ³n y observaciones separadas:
   - descripcion: QuÃ© contiene el reporte
   - observaciones: Notas y comentarios sobre el reporte

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEGURIDAD                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Siempre valida los permisos antes de mostrar/editar reportes
2. No expongas informaciÃ³n sensible en datos_json
3. Usa HTTPS en producciÃ³n
4. Valida todos los datos de entrada
5. Limita el tamaÃ±o de datos_json para evitar problemas

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RENDIMIENTO                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Usa filtros cuando listes reportes para reducir la carga
2. Implementa paginaciÃ³n en el frontend
3. No generes PDFs innecesariamente (ya estÃ¡n marcados como generados)
4. Limita el tamaÃ±o de datos_json (mÃ¡ximo recomendado: 10MB)

=================================================================
10. CONFIGURACIÃ“N E INSTALACIÃ“N
=================================================================

Para usar el mÃ³dulo de reportes, asegÃºrate de tener configurado lo siguiente:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSTALACIÃ“N DE DEPENDENCIAS                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El mÃ³dulo requiere las siguientes dependencias (ya incluidas en requirements.txt):

- Django >= 4.2
- djangorestframework
- reportlab (para generaciÃ³n de PDF)
- pillow (para manejo de imÃ¡genes en PDF, si se necesita)

Instalar:
pip install -r requirements.txt

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONFIGURACIÃ“N EN SETTINGS.PY                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El mÃ³dulo ya estÃ¡ agregado en INSTALLED_APPS:

INSTALLED_APPS = [
    ...
    'reportes',
]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONFIGURACIÃ“N DE URLs                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Las rutas ya estÃ¡n configuradas en backend/urls.py:

urlpatterns = [
    ...
    path('api/reportes/', include('reportes.urls')),
]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRACIONES                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Para crear las tablas en la base de datos:

python manage.py makemigrations reportes
python manage.py migrate

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONFIGURACIÃ“N DEL ADMIN                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El modelo Reporte ya estÃ¡ registrado en el admin de Django.
Puedes acceder a Ã©l desde: http://localhost:8000/admin/reportes/reporte/

=================================================================
11. CONCLUSIÃ“N
=================================================================

El mÃ³dulo de reportes estÃ¡ completamente funcional y listo para usar.
Incluye todas las funcionalidades esenciales:

âœ… Crear reportes
âœ… Editar reportes
âœ… Consultar estado
âœ… Filtrar y buscar reportes
âœ… Generar PDFs profesionales
âœ… Enviar reportes por correo
âœ… Sistema de permisos robusto
âœ… Fechas de mediciÃ³n
âœ… Estados de reporte
âœ… IDs Ãºnicos de reporte

Si tienes preguntas o necesitas ayuda adicional, consulta los comentarios
en el cÃ³digo o contacta al equipo de desarrollo.

Â¡Feliz codificaciÃ³n! ğŸš€

=================================================================
FIN DE LA DOCUMENTACIÃ“N
=================================================================
